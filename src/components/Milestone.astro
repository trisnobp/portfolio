---
import { Image } from 'astro:assets'
import type { ImageMetadata } from 'astro'
import { cn } from '@/utils'

const {
	class: className,
	title,
	subtitle,
	period,
	imagePath,
	altText = '',
	imageClass,
	isFirst = false,
	isLast = false
} = Astro.props

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/*.{jpeg,jpg,png,gif}')

if (imagePath && !images[imagePath]) {
	throw new Error(`"${imagePath}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`)
}
---

<li
	class={cn(
		'relative pb-8 pl-10 last:pb-0',
		!isFirst &&
			'before:absolute before:left-3 before:top-0 before:h-8 before:w-px before:bg-primary/80 before:content-[""]',
		!isLast &&
			'after:absolute after:left-3 after:top-10 after:bottom-0 after:w-px after:bg-primary/80 after:content-[""]',
		className
	)}
>
	<div
		class='absolute left-3 top-6 flex h-5 w-5 -translate-x-1/2 items-center justify-center rounded-full border-2 border-primary bg-background shadow-[0_0_0_6px] shadow-primary/15 transition-colors dark:shadow-primary/25'
		aria-hidden='true'
	>
		<span class='h-2.5 w-2.5 rounded-full bg-primary'></span>
	</div>

	<div
		class='rounded-2xl border border-border bg-primary-foreground p-4 shadow-sm transition-colors'
	>
		{
			imagePath && (
				<Image
					src={images[imagePath]()}
					alt={altText}
					class={cn('mb-3 h-12 w-auto md:h-14', imageClass)}
					loading='lazy'
				/>
			)
		}

		<div class='flex flex-col gap-y-1'>
			<h3 class='text-lg font-semibold'>{title}</h3>
			<p class='text-sm text-muted-foreground'>{subtitle}</p>
			<p class='text-sm text-muted-foreground'>{period}</p>
		</div>

		<div class='mt-3 flex flex-col gap-y-2 text-muted-foreground'>
			<slot />
		</div>
	</div>
</li>
